---
title: Rotation Checklist
description: Step-by-step procedures for secret rotation
---

# Rotation Checklist

This checklist provides step-by-step procedures for rotating secrets in different scenarios.

## Scheduled Rotation (Manual)

Use this checklist for routine, scheduled secret rotations.

### Pre-Rotation

- [ ] Verify maintenance window (if configured)
- [ ] Check for any active deployments or incidents
- [ ] Review recent audit logs for the secret
- [ ] Confirm no recent rotations within cooldown period
- [ ] Notify team of upcoming rotation (if required)

### Rotation Steps

1. **Dry-Run First**

```bash
keystone rotate <SECRET_NAME> --env prod --service <SERVICE> --dry-run
```

- [ ] Review dry-run output
- [ ] Verify secret name and environment are correct

2. **Execute Rotation**

```bash
keystone rotate <SECRET_NAME> --env prod --service <SERVICE>
```

- [ ] Confirm when prompted
- [ ] Wait for completion
- [ ] Note rotation timestamp

3. **Optional: Trigger Redeploy**

```bash
keystone rotate <SECRET_NAME> --env prod --service <SERVICE> --redeploy
```

- [ ] Monitor deployment progress
- [ ] Wait for deployment to complete

### Post-Rotation

- [ ] Verify application health
- [ ] Check application logs for errors
- [ ] Confirm secret is being used correctly
- [ ] Review audit log entry:

```bash
keystone audit <SECRET_NAME> --env prod --last 1
```

- [ ] Document completion in team tracking system

## Emergency Rotation (Compromised Secret)

Use this checklist when a secret has been compromised and requires immediate rotation.

### Immediate Actions

- [ ] Assess scope of compromise
- [ ] Notify security team
- [ ] Begin incident response procedures

### Rotation Steps

1. **Skip Dry-Run** (time-sensitive)

2. **Rotate Immediately**

```bash
keystone rotate <SECRET_NAME> --env prod --service <SERVICE> --redeploy
```

- [ ] Confirm when prompted
- [ ] Note exact rotation time

3. **Verify New Secret**

- [ ] Check provider console for new value
- [ ] Verify application is using new secret

4. **Revoke Old Secret at Provider**

- [ ] Log into provider console
- [ ] Revoke/delete the old key
- [ ] Document revocation timestamp

### Post-Rotation

- [ ] Monitor application health closely
- [ ] Review access logs for suspicious activity
- [ ] Update incident timeline
- [ ] Complete incident post-mortem

## App-Signal Rotation (Automated)

Use this checklist to set up and monitor app-signal-triggered rotations.

### Setup

1. **Start Daemon**

```bash
keystone daemon start
```

- [ ] Verify daemon is running:

```bash
keystone daemon status
```

2. **Configure Application**

Add to your application code (example in Node.js):

```javascript
async function handleRateLimit(secretName) {
  await fetch('http://127.0.0.1:9123/rotate', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      secret_name: secretName,
      env: 'prod',
      service: 'vercel'
    })
  });
}
```

- [ ] Deploy application changes
- [ ] Test signal endpoint

### Monitoring

- [ ] Review daemon logs:

```bash
tail -f ~/.keystone/daemon.log
```

- [ ] Check for rotation signals in audit logs:

```bash
keystone audit --last 10 | grep Signal
```

- [ ] Monitor cooldown behavior (signals should be debounced)

## Development Mode Rotation

Use this checklist for rotating secrets in local `.env` files.

### Steps

1. **Backup Current .env** (optional)

```bash
cp .env .env.backup
```

2. **Rotate Secret**

```bash
keystone rotate <SECRET_NAME> --env dev
```

- [ ] Verify secret in `.env` file:

```bash
grep <SECRET_NAME> .env
```

- [ ] Note rollback file location: `.keystone-rollback`

3. **Restart Application**

```bash
npm run dev
# or
cargo run
```

- [ ] Verify application starts successfully
- [ ] Test functionality dependent on the secret

### Rollback (if needed)

```bash
keystone rollback <SECRET_NAME> --env dev
```

Or manually:

```bash
cp .keystone-rollback .env
```

## Multi-Environment Rotation

Use this checklist for rotating the same secret across multiple environments.

### Steps

1. **Start with Development**

```bash
keystone rotate <SECRET_NAME> --env dev
```

- [ ] Test thoroughly in dev
- [ ] Verify no issues

2. **Move to Staging**

```bash
keystone rotate <SECRET_NAME> --env staging --service <SERVICE>
```

- [ ] Deploy to staging
- [ ] Run integration tests
- [ ] Verify no issues

3. **Deploy to Production**

```bash
keystone rotate <SECRET_NAME> --env prod --service <SERVICE> --redeploy
```

- [ ] Confirm when prompted
- [ ] Monitor deployment
- [ ] Verify application health

4. **Document**

- [ ] Record rotation in change log
- [ ] Update team documentation
- [ ] Schedule next rotation

## Troubleshooting

### If Rotation Fails

1. **Check Error Message**

- Lock held? Wait or remove stale lock
- Cooldown active? Wait or adjust cooldown
- Provider API error? Check credentials and API status

2. **Review Audit Logs**

```bash
keystone audit <SECRET_NAME> --env <ENV> --last 5
```

3. **Check Provider Console**

- Verify old secret is still active
- Check for any provider-side issues

4. **Consider Rollback**

If application is broken:

```bash
keystone rollback <SECRET_NAME> --env <ENV> --service <SERVICE> --redeploy
```

### If Application Breaks After Rotation

1. **Check Application Logs**

- Look for authentication errors
- Verify secret is being loaded correctly

2. **Verify Secret Value at Provider**

- Check provider console
- Ensure secret was updated correctly

3. **Rollback Immediately**

```bash
keystone rollback <SECRET_NAME> --env <ENV> --service <SERVICE> --redeploy
```

4. **Investigate Root Cause**

- Was the new secret value malformed?
- Did the application fail to reload?
- Was there a provider-side delay?

