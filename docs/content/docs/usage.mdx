---
title: Usage Guide
description: Complete guide to using Keystone for secret rotation
---

This guide covers all aspects of using Keystone for secret rotation in development and production.

## Basic Commands

### Rotate a Secret

```bash
keystone rotate SECRET_NAME --env ENV [--service SERVICE] [OPTIONS]
```

**Arguments:**
- `SECRET_NAME`: Name of the secret to rotate
- `--env`: Environment (dev/staging/prod)
- `--service`: Service/provider (vercel/netlify/render/etc.)

**Options:**
- `--dry-run`: Preview changes without applying
- `--redeploy`: Trigger redeploy after rotation
- `--value`: Provide custom secret value
- `--env-file`: Path to `.env` file (dev mode only)

### Rollback a Secret

```bash
keystone rollback SECRET_NAME --env ENV [--service SERVICE] [OPTIONS]
```

**Options:**
- `--redeploy`: Trigger redeploy after rollback

### Daemon Management

```bash
keystone daemon start [--bind ADDRESS]
keystone daemon stop
keystone daemon status
```

### View Audit Logs

```bash
keystone audit [SECRET_NAME] [OPTIONS]
```

**Options:**
- `--env`: Filter by environment
- `--last N`: Show last N entries

## Detailed Workflows

<Cards>
  <Card title="Development Rotation" href="/docs/usage/dev-mode" />
  <Card title="Production Rotation" href="/docs/usage/prod-mode" />
  <Card title="App-Signal Rotation" href="/docs/usage/app-signals" />
  <Card title="Rollback Procedures" href="/docs/usage/rollback" />
</Cards>

## Safety Features

### Dry-Run Mode

Always test with dry-run first:

```bash
keystone rotate MY_API_KEY --env prod --service vercel --dry-run
```

### Cooldown Period

Prevents rapid successive rotations (default: 60 seconds):

```bash
# Will fail if rotated recently
keystone rotate MY_API_KEY --env prod --service vercel
# Error: Cooldown active: wait 45s before rotating again
```

### Single-Writer Locks

Prevents concurrent rotations of the same secret:

```bash
# Terminal 1
keystone rotate MY_API_KEY --env prod --service vercel

# Terminal 2 (simultaneously)
keystone rotate MY_API_KEY --env prod --service vercel
# Error: Lock already held by PID 12345
```

### Maintenance Windows

Production rotations can be restricted to specific time windows:

```toml
[[maintenance_windows]]
start_hour = 2
end_hour = 6
days = ["Saturday", "Sunday"]
```

Outside these windows, you'll be prompted to confirm.

### Confirmation Prompts

Production rotations always require explicit confirmation:

```bash
keystone rotate MY_API_KEY --env prod --service vercel
# Preview: New secret value: ***xyz
# Update 'MY_API_KEY' in prod environment? (y/n): 
```

## Common Patterns

### Scheduled Rotations

Use cron for periodic rotations:

```bash
# Rotate weekly on Sunday at 3 AM
0 3 * * 0 /usr/local/bin/keystone rotate MY_API_KEY --env prod --service vercel
```

### Multi-Environment Rotation

Rotate across all environments:

```bash
#!/bin/bash
for env in dev staging prod; do
  keystone rotate MY_API_KEY --env $env --service vercel
done
```

### Conditional Rotation

Rotate only if approaching expiry:

```bash
# In your app (example in bash)
if [ "$DAYS_UNTIL_EXPIRY" -lt 7 ]; then
  curl -X POST http://localhost:9123/rotate \
    -H "Content-Type: application/json" \
    -d '{"secret_name": "MY_API_KEY", "env": "prod", "service": "vercel"}'
fi
```

## Next Steps

- [Learn about specific providers](/docs/connectors)
- [Read the operator runbook](/docs/operators/runbook)
- [Implement app-signal rotation](/docs/usage/app-signals)

